# daemon

## todo

- 프로가드 적용
- 처음 사용자가 입력하면 실행 후 부팅 시 마다 실행하도록
- http를 사용하면 되는지? 실행하면 port번호를 고정적으로 줄지(현재는 8092)
- SpringSecurity를 사용하여 특정 IP범위를 화이트리스트에 추가?(해야할지 고민중)
- postgre SQL 적용
- ssh 포트 지워야하는지
- daemon이 띄워져 있는지(api가 어떻게 답하는지 확인해서 daemon을 다시 실행시켜줘야하는 경우가 생길 수 있음)
- heaven이 실행중인지 확인하는 것
- 테스트 케이스 리스트업(사용자가 사용하는 플로우에 따라 여러개 만들어놓기)
- token 암호화해서 heaven에 전달
- .token 파일은 제거
- run-coyote-daemon.sh 파일도 제거할지는 생각해보기
- 디렉토리 여러개 생성하지 않도록. 계정마다 생성하는게 아니라 데몬을 통해서 하나의 서버에서 포트를 통해서 사용할 수 있도록.

/ : 루트  
/home/C1/.coyote : 각 설정파일  
/coyote/workspace :

<br /><br />

---

<br /><br />

## 고객쪽 실행 시 챙겨야 할 것

1. postgre 설치
2. 멀티모듈의 https사용을 위해 ssl인증서 발급

<br /><br />

---

<br /><br />

## connection 기반 정책

[도커를 위한 라이선스](https://docs.google.com/presentation/d/11XEImASkMkR1X2lFqSp4zc7WDK4e-J9Hz3NjMDzaVr4/edit#slide=id.g15024441d7e_0_82)

1. server 자체 체크
2. connection 이 유효한지

connection(serverA<->clientA)
connection(serverA<->clientB)
connection(serverB<->clientB)

---

서버데몬

서버데몬 라이선스 content

- 서버의 기기 아이디
- 클라이언트 화이트 리스트(salt 암호화 필요)
- (비대칭키로 암호화된 salt)

커넥션 = (client 기기 아이디, server 기기 아이디)

> sever 기기 아이디는 고정됨

1. 서버데몬의 라이선스가 유효한가?
   -> 서버데몬의 시작시

2. 커넥션 제한 기능 + 계정
   -> 사용자가 연결 시도 시
   -> 화이트 리스트 안에 존재하는 클라이언트 기기인지 체크
   -> OK 면 연결 허용

---

헤븐

1. legacy mode

- 옛날 방식으로 라이선스 체크를 하면 됨
- 그냥 켜면 라이선스 파일 읽아서 구동됨 (--lc-legacy)

2. server daemon mode

- 라이선스 파일을 안 읽어와
- 서버 데몬이 OTP 를 줘서 구동이 되어야 함 (--lc-deamon)

---

OTP

(비대칭키로 암호화된 salt),
OTP md5(YYYYMMDDHHMM+기기아이디+salt)

OTP-T1:md5(YYYYMMDDHHMM-1m+기기아이디+salt)
OTP=T0:md5(YYYYMMDDHHMM+기기아이디+salt)
OTP+T1:md5(YYYYMMDDHHMM+1m+기기아이디+salt)
